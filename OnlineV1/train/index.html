<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Model</title>
</head>
<body>
    <h1>Train Model</h1>
    <div>
        <label for="numIterations">Number of Iterations:</label>
        <input type="number" id="numIterations" name="numIterations" value="10000">
    </div>
    <div>
        <label for="goalR2">R2 Goal</label>
        <input type="text" id="goalR2" name="goalR2" value="0.95">
    </div>
    <div>
        <label for="csv1">RGB Value</label>
        <textarea id="csv1" name="csv1" rows="5" cols="50" >R,G,B
            0.329341317,0.19760479,0.113772455
            0.347305389,0.221556886,0.113772455
            0.329341317,0.22754491,0.167664671
            0.365269461,0.239520958,0.137724551
            0.353293413,0.22754491,0.143712575
            0.329341317,0.203592814,0.077844311
            0.353293413,0.239520958,0.155688623
            0.329341317,0.203592814,0.083832335
            0.335329341,0.209580838,0.107784431
            0.323353293,0.19760479,0.095808383
            0.329341317,0.209580838,0.107784431
            0.299401198,0.161676647,0.053892216
            0.275449102,0.155688623,0.065868263
            0.299401198,0.185628743,0.095808383
            0.329341317,0.215568862,0.131736527
            0.335329341,0.19760479,0.089820359
            0.371257485,0.239520958,0.137724551
            0.353293413,0.221556886,0.089820359
            0.335329341,0.203592814,0.119760479
            0.353293413,0.215568862,0.119760479
            0.329341317,0.191616766,0.077844311
            0.323353293,0.19760479,0.083832335
            0.28742515,0.167664671,0.05988024
            0.299401198,0.179640719,0.065868263
            0.299401198,0.191616766,0.101796407
            0.311377246,0.185628743,0.083832335
            0.305389222,0.167664671,0.089820359
            0.293413174,0.173652695,0.083832335
            0.263473054,0.149700599,0.065868263
            0.323353293,0.191616766,0.089820359
            0.317365269,0.185628743,0.077844311
            0.329341317,0.209580838,0.119760479
            0.341317365,0.209580838,0.095808383
            0.341317365,0.19760479,0.083832335
            0.281437126,0.155688623,0.065868263
            0.311377246,0.185628743,0.071856287
            0.323353293,0.185628743,0.077844311
            0.245508982,0.137724551,0.02994012
            0.311377246,0.191616766,0.05988024
            0.323353293,0.185628743,0.089820359
            0.311377246,0.19760479,0.113772455
            0.335329341,0.203592814,0.089820359
            0.335329341,0.209580838,0.125748503
            0.329341317,0.19760479,0.077844311
            0.305389222,0.179640719,0.083832335
            0.347305389,0.22754491,0.125748503
            0.311377246,0.179640719,0.101796407
            0.323353293,0.203592814,0.113772455
            0.323353293,0.19760479,0.095808383
            0.269461078,0.143712575,0.05988024
            0.347305389,0.203592814,0.083832335
            0.311377246,0.173652695,0.077844311
            0.299401198,0.167664671,0.083832335
            0.323353293,0.19760479,0.095808383
            0.305389222,0.179640719,0.083832335
            0.347305389,0.209580838,0.083832335
            0.317365269,0.185628743,0.077844311
            0.311377246,0.185628743,0.095808383
            0.317365269,0.191616766,0.077844311
            0.263473054,0.149700599,0.077844311
            0.353293413,0.209580838,0.083832335
            0.371257485,0.239520958,0.113772455
            0.269461078,0.143712575,0.041916168
            0.323353293,0.179640719,0.05988024
            0.347305389,0.203592814,0.077844311
            0.359281437,0.203592814,0.083832335
            0.335329341,0.19760479,0.077844311
            0.335329341,0.209580838,0.095808383
            0.323353293,0.185628743,0.041916168
            0.341317365,0.19760479,0.065868263
            0.371257485,0.22754491,0.095808383
            0.311377246,0.179640719,0.065868263
            0.28742515,0.161676647,0.041916168
            0.311377246,0.185628743,0.065868263
            0.341317365,0.203592814,0.095808383
            0.317365269,0.173652695,0.077844311
            0.353293413,0.215568862,0.101796407
            0.353293413,0.22754491,0.113772455
            0.341317365,0.209580838,0.125748503
            0.311377246,0.173652695,0.077844311
            0.335329341,0.215568862,0.071856287
            0.329341317,0.191616766,0.05988024
            0.359281437,0.22754491,0.071856287
            0.329341317,0.19760479,0.05988024
            0.359281437,0.22754491,0.077844311
            0.341317365,0.215568862,0.077844311
            0.341317365,0.215568862,0.077844311
            0.371257485,0.221556886,0.071856287
            0.353293413,0.233532934,0.083832335
            0.371257485,0.22754491,0.077844311
            0.365269461,0.215568862,0.071856287
            0.383233533,0.245508982,0.077844311
            0.365269461,0.239520958,0.083832335
            0.371257485,0.239520958,0.095808383
            0.353293413,0.22754491,0.101796407
            0.365269461,0.22754491,0.083832335
            0.317365269,0.185628743,0.041916168
            0.359281437,0.221556886,0.083832335
            0.335329341,0.209580838,0.083832335
            0.371257485,0.239520958,0.101796407
            0.335329341,0.233532934,0.119760479
            0.311377246,0.19760479,0.05988024
            0.341317365,0.239520958,0.107784431
            0.353293413,0.221556886,0.089820359
            0.341317365,0.22754491,0.131736527
            0.335329341,0.215568862,0.083832335
            0.365269461,0.239520958,0.125748503
            0.317365269,0.19760479,0.065868263
            0.335329341,0.221556886,0.077844311
            0.329341317,0.22754491,0.113772455
            0.383233533,0.251497006,0.107784431
            0.353293413,0.233532934,0.125748503
            0.323353293,0.209580838,0.119760479
            0.377245509,0.251497006,0.101796407
            0.329341317,0.22754491,0.101796407
            0.371257485,0.251497006,0.113772455
            0.341317365,0.221556886,0.089820359
            0.329341317,0.203592814,0.065868263
            0.329341317,0.221556886,0.101796407
            0.419161677,0.275449102,0.149700599
            0.425149701,0.353293413,0.119760479
            0.45508982,0.401197605,0.167664671
            0.401197605,0.347305389,0.107784431
            0.395209581,0.335329341,0.119760479
            0.449101796,0.395209581,0.173652695
            0.508982036,0.437125749,0.19760479
            0.461077844,0.389221557,0.155688623
            0.425149701,0.359281437,0.143712575
            0.497005988,0.425149701,0.167664671
            0.419161677,0.365269461,0.131736527
            0.431137725,0.359281437,0.119760479
            0.425149701,0.353293413,0.113772455
            0.419161677,0.365269461,0.155688623
            0.461077844,0.389221557,0.149700599
            0.425149701,0.371257485,0.131736527
            0.431137725,0.359281437,0.119760479
            0.461077844,0.401197605,0.185628743
            0.473053892,0.419161677,0.173652695
            0.407185629,0.353293413,0.107784431
            0.461077844,0.407185629,0.155688623
            0.538922156,0.532934132,0.239520958
            0.45508982,0.461077844,0.173652695
            0.550898204,0.550898204,0.245508982
            0.556886228,0.550898204,0.25748503
            0.473053892,0.467065868,0.179640719
            0.473053892,0.467065868,0.179640719
            0.532934132,0.532934132,0.233532934
            0.526946108,0.520958084,0.233532934
            0.526946108,0.526946108,0.22754491
            0.491017964,0.491017964,0.19760479
            0.54491018,0.54491018,0.239520958
            0.467065868,0.461077844,0.173652695
            0.502994012,0.502994012,0.215568862
            0.467065868,0.473053892,0.209580838
            0.479041916,0.491017964,0.19760479
            0.497005988,0.497005988,0.19760479
            0.508982036,0.502994012,0.215568862
            0.48502994,0.479041916,0.191616766
            0.491017964,0.48502994,0.209580838
            0.520958084,0.51497006,0.22754491
            0.479041916,0.520958084,0.209580838
            0.598802395,0.640718563,0.311377246
            0.556886228,0.598802395,0.281437126
            0.628742515,0.682634731,0.365269461
            0.562874251,0.604790419,0.281437126
            0.610778443,0.652694611,0.335329341
            0.604790419,0.664670659,0.353293413
            0.646706587,0.694610778,0.353293413
            0.574850299,0.616766467,0.317365269
            0.538922156,0.592814371,0.263473054
            0.592814371,0.634730539,0.317365269
            0.538922156,0.592814371,0.275449102
            0.592814371,0.646706587,0.323353293
            0.592814371,0.640718563,0.305389222
            0.598802395,0.652694611,0.311377246
            0.586826347,0.628742515,0.293413174
            0.586826347,0.640718563,0.311377246
            0.54491018,0.586826347,0.263473054
            0.520958084,0.574850299,0.245508982
            0.574850299,0.622754491,0.28742515
            0.562874251,0.640718563,0.311377246
            0.610778443,0.694610778,0.341317365
            0.610778443,0.700598802,0.359281437
            0.580838323,0.670658683,0.341317365
            0.664670659,0.748502994,0.383233533
            0.622754491,0.71257485,0.377245509
            0.610778443,0.694610778,0.335329341
            0.556886228,0.640718563,0.323353293
            0.574850299,0.664670659,0.329341317
            0.586826347,0.670658683,0.311377246
            0.640718563,0.724550898,0.359281437
            0.616766467,0.694610778,0.353293413
            0.538922156,0.616766467,0.293413174
            0.574850299,0.658682635,0.305389222
            0.538922156,0.616766467,0.293413174
            0.640718563,0.718562874,0.383233533
            0.610778443,0.688622754,0.377245509
            0.586826347,0.670658683,0.317365269
            0.628742515,0.71257485,0.359281437
            0.610778443,0.694610778,0.341317365
            0.682634731,0.80239521,0.413173653
            0.670658683,0.790419162,0.377245509
            0.694610778,0.808383234,0.425149701
            0.640718563,0.754491018,0.371257485
            0.646706587,0.760479042,0.365269461
            0.694610778,0.814371257,0.401197605
            0.676646707,0.784431138,0.401197605
            0.736526946,0.856287425,0.425149701
            0.646706587,0.760479042,0.383233533
            0.670658683,0.784431138,0.389221557
            0.652694611,0.766467066,0.383233533
            0.670658683,0.778443114,0.407185629
            0.688622754,0.80239521,0.407185629
            0.676646707,0.796407186,0.389221557
            0.634730539,0.748502994,0.365269461
            0.706586826,0.820359281,0.425149701
            0.652694611,0.77245509,0.395209581
            0.616766467,0.730538922,0.347305389
            0.724550898,0.844311377,0.419161677
            0.634730539,0.754491018,0.383233533
            0.706586826,0.856287425,0.449101796
            0.688622754,0.844311377,0.431137725
            0.658682635,0.808383234,0.413173653
            0.634730539,0.784431138,0.389221557
            0.658682635,0.820359281,0.407185629
            0.730538922,0.880239521,0.479041916
            0.670658683,0.814371257,0.413173653
            0.676646707,0.838323353,0.425149701
            0.676646707,0.832335329,0.419161677
            0.700598802,0.862275449,0.449101796
            0.670658683,0.826347305,0.407185629
            0.706586826,0.862275449,0.443113772
            0.688622754,0.850299401,0.425149701
            0.682634731,0.844311377,0.431137725
            0.688622754,0.844311377,0.419161677
            0.682634731,0.832335329,0.437125749
            0.688622754,0.856287425,0.413173653
            0.640718563,0.80239521,0.401197605
            0.616766467,0.760479042,0.365269461
            0.688622754,0.844311377,0.419161677
            0.700598802,0.880239521,0.449101796
            0.80239521,0.988023952,0.532934132
            0.71257485,0.892215569,0.461077844
            0.718562874,0.898203593,0.467065868
            0.676646707,0.856287425,0.431137725
            0.718562874,0.898203593,0.467065868
            0.77245509,0.958083832,0.491017964
            0.71257485,0.892215569,0.449101796
            0.77245509,0.958083832,0.502994012
            0.754491018,0.94011976,0.473053892
            0.724550898,0.898203593,0.491017964
            0.760479042,0.946107784,0.491017964
            0.664670659,0.838323353,0.437125749
            0.724550898,0.904191617,0.473053892
            0.700598802,0.880239521,0.449101796
            0.730538922,0.910179641,0.473053892
            0.814371257,1,0.54491018
            0.682634731,0.862275449,0.443113772
            0.724550898,0.904191617,0.48502994
            0.682634731,0.862275449,0.443113772
            </textarea>
    </div>
    <div>
        <label for="csv2">Concentration Value:</label>
        <textarea id="csv2" name="csv2" rows="5" cols="50">Concentration
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.01
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.05
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.1
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            0.5
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            1
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            5
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            10
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            15
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            20
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            30
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            40
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            50
            </textarea>
    </div>
    <button onclick="trainModel()">Train Model</button>
    <div id="progress-bar-container">
        <div id="progress-bar" style="width: 0%; background-color: #4CAF50; height: 30px;"></div>
    </div>
    <p id="status"></p>

    <script>
        async function trainModel() {
            const numIterations = document.getElementById("numIterations").value;
            const goalContent = document.getElementById("goalR2").value;
            const csv1Content = document.getElementById("csv1").value;
            const csv2Content = document.getElementById("csv2").value;

            const socket = new WebSocket('ws://localhost:8000/train');

            socket.onopen = function(event) {
                console.log('WebSocket connection established.');
                
                const requestData = {
                    num_iterations: numIterations,
                    goal: goalContent,
                    csv1: csv1Content,
                    csv2: csv2Content
                };

                socket.send(JSON.stringify(requestData));
            };

            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log(data);
                var progress = 0;
                const statusNow = document.getElementById('status')
                statusNow.innerHTML = data.status
                if(data.status==="busy")
                {
                    progress = data.iteration / numIterations *100 ;
                }
                else if(data.status==="done")
                {
                    progress = 100;
                    if(data.R2 >= goalContent)
                    {
                        statusNow.innerHTML = "Model="+ data.Model +",R2="+data.R2;
                    }
                    else if(data.R2 < goalContent)
                    {
                        statusNow.innerHTML = "R^2="+data.R2+",the calculated value is less than the target value"
                    }
                }
                const progressBar = document.getElementById('progress-bar');
                progressBar.style.width = progress + '%';
            };

            socket.onerror = function(event) {
                console.error('WebSocket error:', event);
            };

            socket.onclose = function(event) {
                console.log('WebSocket connection closed.');
            };
        }
    </script>
</body>
</html>
